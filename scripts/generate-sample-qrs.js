const mongoose = require('mongoose');
require('dotenv').config();

const { generateQRBatch } = require('../services/qrService');
const User = require('../models/User');

const generateSampleQRs = async () => {
  try {
    // Connect to MongoDB
    await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/qr_vehicle_emergency');
    console.log('‚úÖ Connected to MongoDB');

    // Find admin user
    const admin = await User.findOne({ role: 'admin' });
    if (!admin) {
      console.log('‚ùå No admin user found. Please run seed-admin-user.js first');
      process.exit(1);
    }

    const baseUrl = process.env.CALLER_URL || 'http://localhost:8000';
    
    // Generate sample QR codes
    console.log('üîÑ Generating sample QR codes...');
    
    const result = await generateQRBatch(
      20, // count
      'SAMPLE_001', // batch number
      'sticker', // qr type
      admin.userId, // generated by
      baseUrl
    );

    console.log('‚úÖ Sample QR codes generated successfully');
    console.log('üìä Batch Info:', result.batchInfo);
    console.log('üîó Sample QR URLs:');
    
    result.qrCodes.slice(0, 5).forEach(qr => {
      console.log(`   ${qr.qrId}: ${qr.qrUrl}`);
    });

    console.log(`   ... and ${result.qrCodes.length - 5} more`);

    process.exit(0);
  } catch (error) {
    console.error('‚ùå Error generating sample QRs:', error);
    process.exit(1);
  }
};

generateSampleQRs();